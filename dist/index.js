import{useApi as e,defineInterface as n}from"@directus/extensions-sdk";import{defineComponent as t,ref as a,computed as i,watch as o,resolveComponent as r,resolveDirective as l,openBlock as d,createElementBlock as s,createBlock as u,withCtx as c,createTextVNode as v,toDisplayString as g,normalizeClass as m,createVNode as p,createElementVNode as f,withDirectives as h,createCommentVNode as b,pushScopeId as y,popScopeId as w}from"vue";let x=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,n)=>e+=(n&=63)<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n>62?"-":"_"),"");function k(){const e=window.location.pathname.split("/"),n=e.indexOf("admin");return e.slice(0,n).join("/")+"/"}function _(e,n,t){const a=t||function(e){var n;return(null==(n=e.defaults.headers.common.Authorization)?void 0:n.split(" ")[1])||null}(e);return a?function(e,n){const t=[];for(const[e,a]of Object.entries(n))t.push(`${e}=${a}`);return e.includes("?")?`${e}&${t.join("&")}`:`${e}?${t.join("&")}`}(n,{access_token:a}):n}var $=t({components:{},props:{value:{type:[String,Object],default:null},disabled:{type:Boolean,default:!1},folder:{type:String,default:void 0},file_key_to_get:{type:String,default:"filename_disk"}},emits:["input"],setup(n,{emit:t}){const r=a(!1),l=a(null),d=a(!1),s=a(!1),u=a(null),c=a(x()),v=e(),g=i((()=>{if(!l.value)return null;if(l.value.type.includes("svg"))return _(v,k()+`assets/${l.value.id}`);if(l.value.type.includes("image")){const e=k()+`assets/${l.value.id}?key=system-large-cover&cache-buster=${c.value}`;return _(v,e)}return null})),m=i((()=>l.value?_(v,k()+`assets/${l.value.id}`):null)),p=i((()=>{if(!l.value)return null;const{filesize:e,width:n,height:t,type:a}=l.value;return n&&t?`${n}x${t} • ${e} • ${a}`:`${e} • ${a}`}));o((()=>n.value),((e,t)=>{e!==t&&(e&&async function(){var e;r.value=!0;try{let t="string"==typeof n.value?n.value:null==(e=n.value)?void 0:e.id;t=t.split(".").slice(0,-1).join(".");const a=await v.get(`/files/${t}`,{params:{fields:["id","title","width","height","filesize","type","filename_download"]}});null!==n.value&&"object"==typeof n.value?l.value={...a.data.data,...n.value}:l.value=a.data.data}catch(e){console.log(e)}finally{r.value=!1}}(),t&&null===e&&b())}),{immediate:!0});const{edits:f,stageEdits:h}={edits:i((()=>n.value&&"object"==typeof n.value?n.value:{})),stageEdits:function(e){l.value&&(console.log(e),t("input",l.value[n.file_key_to_get]))}};return{loading:r,image:l,src:g,imageError:u,imageErrorHandler:async function(){var e,n,t,a;if(!g.value)return;try{await v.get(g.value)}catch(i){u.value=null==(a=null==(t=null==(n=null==(e=i.response)?void 0:e.data)?void 0:n.errors[0])?void 0:t.extensions)?void 0:a.code,u.value||(u.value="UNKNOWN")}},meta:p,lightboxActive:d,editDrawerActive:s,changeCacheBuster:function(){c.value=x()},setImage:function(e){console.log("setImage",e),l.value=e,t("input",e[n.file_key_to_get])},deselect:b,downloadSrc:m,edits:f,stageEdits:h};function b(){t("input",null),r.value=!1,l.value=null,d.value=!1,s.value=!1}}});const E=e=>(y("data-v-64969d30"),e=e(),w(),e),j={class:"image"},A={key:0,class:"image-error"},I={class:"message"},S=["src"],U=E((()=>f("div",{class:"shadow"},null,-1))),z={key:2,class:"actions"},C={class:"info"},N={class:"title"},O={class:"meta"};var D=[],T=[];!function(e,n){if(e&&"undefined"!=typeof document){var t,a=!0===n.prepend?"prepend":"append",i=!0===n.singleTag,o="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(i){var r=D.indexOf(o);-1===r&&(r=D.push(o)-1,T[r]={}),t=T[r]&&T[r][a]?T[r][a]:T[r][a]=l()}else t=l();65279===e.charCodeAt(0)&&(e=e.substring(1)),t.styleSheet?t.styleSheet.cssText+=e:t.appendChild(document.createTextNode(e))}function l(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),n.attributes)for(var t=Object.keys(n.attributes),i=0;i<t.length;i++)e.setAttribute(t[i],n.attributes[t[i]]);var r="prepend"===a?"afterbegin":"beforeend";return o.insertAdjacentElement(r,e),e}}(".image-preview[data-v-64969d30] {\n  position: relative;\n  width: 100%;\n  height: var(--input-height-tall);\n  overflow: hidden;\n  background-color: var(--background-subdued);\n  border-radius: var(--border-radius);\n}\nimg[data-v-64969d30] {\n  z-index: 1;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n.is-svg[data-v-64969d30] {\n  padding: 32px;\n  background-color: var(--background-normal-alt);\n}\n.is-svg img[data-v-64969d30] {\n  object-fit: contain;\n}\n.image-error[data-v-64969d30] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: var(--foreground-subdued);\n  background-color: var(--background-normal);\n}\n.image-error .v-icon[data-v-64969d30] {\n  margin-bottom: 6px;\n}\n.image-error .message[data-v-64969d30] {\n  max-width: 300px;\n  padding: 0 16px;\n  text-align: center;\n}\n.shadow[data-v-64969d30] {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  z-index: 2;\n  width: 100%;\n  height: 40px;\n  overflow: hidden;\n  line-height: 1;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  background: linear-gradient(180deg, rgba(38, 50, 56, 0) 0%, rgba(38, 50, 56, 0.25) 100%);\n  transition: height var(--fast) var(--transition);\n}\n.actions[data-v-64969d30] {\n  --v-button-color: var(--foreground-subdued);\n  --v-button-background-color: var(--white);\n  --v-button-color-hover: var(--foreground-normal);\n  --v-button-background-color-hover: var(--white);\n  position: absolute;\n  top: 30%;\n  left: 0;\n  z-index: 3;\n  display: flex;\n  justify-content: center;\n  width: 100%;\n}\n.actions .v-button[data-v-64969d30] {\n  margin-right: 12px;\n  transform: translateY(10px);\n  opacity: 0;\n  transition: var(--medium) var(--transition);\n  transition-property: opacity transform;\n}\n.actions .v-button[data-v-64969d30]:nth-of-type(1) {\n  transition-delay: 0ms;\n}\n.actions .v-button[data-v-64969d30]:nth-of-type(2) {\n  transition-delay: 25ms;\n}\n.actions .v-button[data-v-64969d30]:nth-of-type(3) {\n  transition-delay: 50ms;\n}\n.actions .v-button[data-v-64969d30]:nth-of-type(4) {\n  transition-delay: 75ms;\n}\n.actions .v-button[data-v-64969d30]:nth-of-type(5) {\n  transition-delay: 100ms;\n}\n.actions .v-button[data-v-64969d30]:last-child {\n  margin-right: 0px;\n}\n.info[data-v-64969d30] {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  z-index: 3;\n  width: 100%;\n  padding: 8px 12px;\n  line-height: 1.2;\n}\n.title[data-v-64969d30] {\n  color: var(--white);\n}\n.meta[data-v-64969d30] {\n  height: 17px;\n  max-height: 0;\n  overflow: hidden;\n  color: rgba(255, 255, 255, 0.75);\n  transition: max-height var(--fast) var(--transition);\n}\n.image-preview:hover .shadow[data-v-64969d30] {\n  height: 100%;\n  background: linear-gradient(180deg, rgba(38, 50, 56, 0) 0%, rgba(38, 50, 56, 0.5) 100%);\n}\n.image-preview:hover .actions .v-button[data-v-64969d30] {\n  transform: translateY(0px);\n  opacity: 1;\n}\n.image-preview:hover .meta[data-v-64969d30] {\n  max-height: 17px;\n}\n.disabled-placeholder[data-v-64969d30] {\n  height: var(--input-height-tall);\n}",{}),$.render=function(e,n,t,a,i,o){const y=r("v-skeleton-loader"),w=r("v-notice"),x=r("v-icon"),k=r("v-button"),_=r("drawer-item"),$=r("file-lightbox"),E=r("v-upload"),D=l("tooltip");return d(),s("div",j,[e.loading?(d(),u(y,{key:0,type:"input-tall"})):e.disabled&&!e.image?(d(),u(w,{key:1,class:"disabled-placeholder",center:"",icon:"block"},{default:c((()=>[v(g("disabled"))])),_:1})):e.image?(d(),s("div",{key:2,class:m(["image-preview",{"is-svg":e.image.type&&e.image.type.includes("svg")}])},[e.imageError?(d(),s("div",A,[p(x,{large:"",name:"UNKNOWN"===e.imageError?"error_outline":"info_outline"},null,8,["name"]),f("span",I,g(`errors.${e.imageError}`),1)])):(d(),s("img",{key:1,src:e.src,alt:"",role:"presentation",onError:n[0]||(n[0]=(...n)=>e.imageErrorHandler&&e.imageErrorHandler(...n))},null,40,S)),U,e.disabled?b("v-if",!0):(d(),s("div",z,[h((d(),u(k,{icon:"",rounded:"",onClick:n[1]||(n[1]=n=>e.lightboxActive=!0)},{default:c((()=>[p(x,{name:"zoom_in"})])),_:1})),[[D,"zoom"]]),h((d(),u(k,{icon:"",rounded:"",href:e.downloadSrc,download:e.image.filename_download},{default:c((()=>[p(x,{name:"get_app"})])),_:1},8,["href","download"])),[[D,"download"]]),h((d(),u(k,{icon:"",rounded:"",onClick:n[2]||(n[2]=n=>e.editDrawerActive=!0)},{default:c((()=>[p(x,{name:"open_in_new"})])),_:1})),[[D,"edit"]]),h((d(),u(k,{icon:"",rounded:"",onClick:e.deselect},{default:c((()=>[p(x,{name:"close"})])),_:1},8,["onClick"])),[[D,"deselect"]])])),f("div",C,[f("div",N,g(e.image.title),1),f("div",O,g(e.meta),1)]),!e.disabled&&e.image?(d(),u(_,{key:3,active:e.editDrawerActive,"onUpdate:active":n[3]||(n[3]=n=>e.editDrawerActive=n),collection:"directus_files","primary-key":e.image.id,edits:e.edits,onInput:e.stageEdits},null,8,["active","primary-key","edits","onInput"])):b("v-if",!0),p($,{id:e.image.id,modelValue:e.lightboxActive,"onUpdate:modelValue":n[4]||(n[4]=n=>e.lightboxActive=n)},null,8,["id","modelValue"])],2)):(d(),u(E,{key:3,"from-library":"","from-url":"",folder:e.folder,onInput:e.setImage},null,8,["folder","onInput"]))])},$.__scopeId="data-v-64969d30",$.__file="src/interface.vue";var V=n({id:"uuid-file-image",name:"UUID File Image",icon:"box",description:"Select image from Library in a UUID string field",component:$,options:null,types:["uuid"]});export{V as default};
